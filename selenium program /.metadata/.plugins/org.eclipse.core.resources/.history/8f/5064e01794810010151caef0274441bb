package pac1;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import io.github.bonigarcia.wdm.WebDriverManager;

import java.time.Duration;

public class TC001 {
    public static void main(String[] args) {
        System.out.println("Test Start...");

        // Setup ChromeDriver
        WebDriverManager.chromedriver().setup();
        WebDriver driver = new ChromeDriver();
        driver.manage().window().maximize();

        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

        try {
            // ------------------ Part 1: Launch site and verify heading ------------------
            System.out.println("\n=== Part 1: Launch site and verify heading ===");
            driver.get("https://tutorialsninja.com/demo/index.php?");
            System.out.println("Page Title: " + driver.getTitle());

            driver.findElement(By.xpath("//span[text()='My Account']")).click();
            driver.findElement(By.linkText("Register")).click();

            WebElement heading = driver.findElement(By.xpath("//div[@id='content']/h1"));
            String headingText = heading.getText();
            if (headingText.equals("Register Account")) {
                System.out.println("Heading Verified: " + headingText);
            } else {
                System.out.println("Heading mismatch! Found: " + headingText);
            }

            // Click Continue without filling form to get warning
            driver.findElement(By.xpath("//input[@value='Continue']")).click();
            WebElement warning = wait.until(ExpectedConditions.visibilityOfElementLocated(
                    By.cssSelector(".alert-danger")));
            System.out.println("Warning Message: " + warning.getText());

            // ------------------ Part 2: Validation tests ------------------
            System.out.println("\n=== Part 2: Validation tests ===");

            // First Name too long
            WebElement firstName = wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("input-firstname")));
            firstName.sendKeys("ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFG"); // 33 chars
            driver.findElement(By.xpath("//input[@value='Continue']")).click();
            WebElement firstNameError = wait.until(ExpectedConditions.visibilityOfElementLocated(
                    By.xpath("//input[@id='input-firstname']/following-sibling::div")));
            System.out.println("First Name Error: " + firstNameError.getText());

            // Last Name too long
            driver.navigate().refresh();
            wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("input-firstname"))).sendKeys("Sri");
            driver.findElement(By.id("input-lastname")).sendKeys("ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFG"); // 33 chars
            driver.findElement(By.xpath("//input[@value='Continue']")).click();
            WebElement lastNameError = wait.until(ExpectedConditions.visibilityOfElementLocated(
                    By.xpath("//input[@id='input-lastname']/following-sibling::div")));
            System.out.println("Last Name Error: " + lastNameError.getText());

            // ------------------ Part 4: Successful registration and order history ------------------
            System.out.println("\n=== Part 4: Successful registration and order history ===");

            // Open a fresh registration page for successful registration
            driver.get("https://tutorialsninja.com/demo/index.php?route=account/register");

            // âš¡ Fixed Email + Password
            String fixedEmail = "srihitha@test.com";   // Always use this one email
            String fixedPassword = "Test1234";

            // Fill all required fields correctly
            wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("input-firstname"))).sendKeys("Srihitha");
            driver.findElement(By.id("input-lastname")).sendKeys("P");
            driver.findElement(By.id("input-email")).sendKeys(fixedEmail);
            driver.findElement(By.id("input-telephone")).sendKeys("9876543210");
            driver.findElement(By.id("input-password")).sendKeys(fixedPassword);
            driver.findElement(By.id("input-confirm")).sendKeys(fixedPassword);

            // Agree checkbox (Privacy Policy)
            WebElement agreeCheckbox = driver.findElement(By.name("agree"));
            if (!agreeCheckbox.isSelected()) agreeCheckbox.click();

            // Newsletter 'Yes'
            WebElement newsletterYes = driver.findElement(By.xpath("//input[@name='newsletter' and @value='1']"));
            if (!newsletterYes.isSelected()) newsletterYes.click();

            // Click Continue button
            driver.findElement(By.xpath("//input[@value='Continue']")).click();

            // Wait for success page or handle if email already exists
            try {
                WebElement successHeader = wait.until(
                        ExpectedConditions.visibilityOfElementLocated(By.xpath("//*[@id='content']/h1")));
                String successMsg = successHeader.getText();
                if (successMsg.equals("Your Account Has Been Created!")) {
                    System.out.println("Account creation successful with: " + fixedEmail);
                }
            } catch (Exception e) {
                WebElement errorMsg = wait.until(ExpectedConditions.visibilityOfElementLocated(
                        By.cssSelector(".alert-danger")));
                System.out.println("Account already exists. Login with: " + fixedEmail);
            }

            // Click Continue if available
            if (driver.findElements(By.linkText("Continue")).size() > 0) {
                driver.findElement(By.linkText("Continue")).click();
            }

            // Navigate to order history if logged in
            if (driver.findElements(By.linkText("View your order history")).size() > 0) {
                WebElement orderHistoryLink = driver.findElement(By.linkText("View your order history"));
                orderHistoryLink.click();
            }

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            driver.quit();
            System.out.println("\nTest Completed!");
        }
    }
}
