package pac1;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import io.github.bonigarcia.wdm.WebDriverManager;

import java.time.Duration;

public class TC001 {
    public static void main(String[] args) {
        System.out.println("Test Start...");

        // Setup ChromeDriver
        WebDriverManager.chromedriver().setup();
        WebDriver driver = new ChromeDriver();
        driver.manage().window().maximize();

        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

        try {
            // ------------------ Part 1: Launch site and verify heading ------------------
            System.out.println("\n=== Part 1: Launch site and verify heading ===");
            driver.get("https://tutorialsninja.com/demo/index.php?");
            System.out.println("Page Title: " + driver.getTitle());

            driver.findElement(By.xpath("//span[text()='My Account']")).click();
            driver.findElement(By.linkText("Register")).click();

            WebElement heading = driver.findElement(By.xpath("//div[@id='content']/h1"));
            String headingText = heading.getText();
            if (headingText.equals("Register Account")) {
                System.out.println("Heading Verified: " + headingText);
            } else {
                System.out.println("Heading mismatch! Found: " + headingText);
            }

            // Click Continue without filling form to get warning
            driver.findElement(By.xpath("//input[@value='Continue']")).click();
            WebElement warning = wait.until(ExpectedConditions.visibilityOfElementLocated(
                    By.cssSelector(".alert-danger")));
            System.out.println("Warning Message: " + warning.getText());

            // ------------------ Part 2: Validation tests ------------------
            System.out.println("\n=== Part 2: Validation tests ===");

            // First Name too long
            WebElement firstName = wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("input-firstname")));
            firstName.sendKeys("ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFG"); // 33 chars
            driver.findElement(By.xpath("//input[@value='Continue']")).click();
            WebElement firstNameError = wait.until(ExpectedConditions.visibilityOfElementLocated(
                    By.xpath("//input[@id='input-firstname']/following-sibling::div")));
            System.out.println("First Name Error: " + firstNameError.getText());

            // Last Name too long
            driver.navigate().refresh();
            wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("input-firstname"))).sendKeys("Sri");
            driver.findElement(By.id("input-lastname")).sendKeys("ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFG"); // 33 chars
            driver.findElement(By.xpath("//input[@value='Continue']")).click();
            WebElement lastNameError = wait.until(ExpectedConditions.visibilityOfElementLocated(
                    By.xpath("//input[@id='input-lastname']/following-sibling::div")));
            System.out.println("Last Name Error: " + lastNameError.getText());

            // ------------------ Part 4: Successful registration and order history ------------------
            System.out.println("\n=== Part 4: Successful registration and order history ===");

            driver.navigate().refresh();
            // Fill all required fields correctly
            wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("input-firstname"))).sendKeys("Srihitha");
            driver.findElement(By.id("input-lastname")).sendKeys("P");
            driver.findElement(By.id("input-email"))
                    .sendKeys("srihitha" + System.currentTimeMillis() + "@test.com");
            driver.findElement(By.id("input-telephone")).sendKeys("9876543210");
            driver.findElement(By.id("input-password")).sendKeys("Test1234");
            driver.findElement(By.id("input-confirm")).sendKeys("Test1234");

            // Agree checkbox (Privacy Policy) must be clicked after refresh
            WebElement agreeCheckbox = driver.findElement(By.name("agree"));
            if (!agreeCheckbox.isSelected()) agreeCheckbox.click();

            // Newsletter 'Yes'
            WebElement newsletterYes = driver.findElement(By.xpath("//input[@name='newsletter' and @value='1']"));
            if (!newsletterYes.isSelected()) newsletterYes.click();

            // Click Continue button
            driver.findElement(By.xpath("//input[@value='Continue']")).click();

            // âœ… Wait for success page and get <h1>
            WebElement successHeader = wait.until(
                    ExpectedConditions.visibilityOfElementLocated(By.xpath("//*[@id='content']/h1")));
            String successMsg = successHeader.getText();
            if (successMsg.equals("Your Account Has Been Created!")) {
                System.out.println("Account creation successful!");
            } else {
                System.out.println("Message mismatch! Found: " + successMsg);
            }

            // Click Continue link after success
            WebElement continueLink = wait.until(ExpectedConditions.elementToBeClickable(
                    By.xpath("//*[@id='content']//a[text()='Continue']")));
            continueLink.click();

            // Navigate to order history
            WebElement orderHistoryLink = wait.until(ExpectedConditions.elementToBeClickable(
                    By.linkText("View your order history")));
            orderHistoryLink.click();

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            driver.quit();
            System.out.println("\nTest Completed!");
        }
    }
}
